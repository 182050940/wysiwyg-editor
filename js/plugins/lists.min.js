/*!
 * froala_editor v1.2.0 (http://editor.froala.com)
 * Copyright 2014-2014 Froala
 */
!function(a){a.Editable.commands=a.extend(a.Editable.commands,{insertOrderedList:{title:"Numbered List",icon:"fa fa-list-ol"},insertUnorderedList:{title:"Bulleted List",icon:"fa fa-list-ul"}}),a.Editable.prototype.execCommand=a.extend(a.Editable.prototype.execCommand,{insertOrderedList:function(a){this.formatList(a)},insertUnorderedList:function(a){this.formatList(a)}}),a.Editable.prototype.processBackspace=function(b){var c=b.prev();if(c.length){this.removeMarkers(),("UL"==c.get(0).tagName||"OL"==c.get(0).tagName)&&(c=c.find("li:last"));var d=c.find("> p, > h1, > h3, > h4, > h5, > h6, > div, > pre, > blockquote");0===c.text().length&&0===c.find("img").length?c.remove():(b.find("> p, > h1, > h3, > h4, > h5, > h6, > div, > pre, > blockquote").each(function(b,c){a(c).replaceWith(a(c).html())}),d.length?(a(d[d.length-1]).append('<span class="f-marker" data-type="true" data-id="0" data-fr-verified="true"></span><span class="f-marker" data-type="false" data-id="0" data-fr-verified="true"></span>'),a(d[d.length-1]).append(b.html())):(c.append('<span class="f-marker" data-type="true" data-id="0" data-fr-verified="true"></span><span class="f-marker" data-type="false" data-id="0" data-fr-verified="true"></span>'),c.append(b.html())),b.remove(),this.$element.find("breakli").remove(),this.restoreSelectionByMarkers())}else this.formatList(b.parents("ul").length?"insertUnorderedList":"insertOrderedList");this.sync(),this.saveUndoStep()},a.Editable.prototype.liBackspace=function(){var b,c=this.getSelectionElement();if(a(c).parents("table").length>0)return!0;b="LI"==c.tagName?a(c):a(c).parents("li:first"),this.removeMarkers(),this.insertHTML("<breakli></breakli>");for(var d,e=b.html(),f=[],g=0;g<e.length;g++){if(char=e.charAt(g),"<"!=char)return this.$element.find("breakli").remove(),!0;var h=e.indexOf(">",g+1);if(-1!==h){d=e.substring(g,h+1);var i=this.tagName(d);if(g=h,"breakli"==i){if(!this.isClosingTag(d)&&!this.isClosingTag(f[f.length-1]))return this.processBackspace(b),!1}else f.push(d)}}return this.$element.find("breakli").remove(),!0},a.Editable.prototype.emptyLiEnter=function(b){this.removeMarkers();var c="ol";b.parents("ul:first").length>0&&(c="ul");var d=a(b.parents("ul, ol")[0]);b.replaceWith(d.parents("ul, ol").length>0?'<span id="close-'+c+'" data-fr-verified="true"></span><li><p><span class="f-marker" data-type="true" data-id="0" data-fr-verified="true"></span><span class="f-marker" data-type="false" data-id="0" data-fr-verified="true"></span><br/></p></li><span id="open-'+c+'" data-fr-verified="true"></span>':'<span id="close-'+c+'" data-fr-verified="true"></span><p><span class="f-marker" data-type="true" data-id="0" data-fr-verified="true"></span><span class="f-marker" data-type="false" data-id="0" data-fr-verified="true"></span><br/></p><span id="open-'+c+'" data-fr-verified="true"></span>'),html=d.html(),html=html.replace('<span id="close-ul" data-fr-verified="true"></span>',"</ul>"),html=html.replace('<span id="close-ol" data-fr-verified="true"></span>',"</ol>"),html=html.replace('<span id="open-ul" data-fr-verified="true"></span>',"<ul>"),html=html.replace('<span id="open-ol" data-fr-verified="true"></span>',"<ol>"),d.replaceWith("<"+c+">"+html+"</"+c+">"),this.cleanupLists()},a.Editable.prototype.textLiEnter=function(b){this.removeMarkers(),this.insertHTML("<breakli></breakli>");for(var c,d=b.html(),e=[],f={},g=[],h=0,i=0;i<d.length;i++)if(char=d.charAt(i),"<"==char){var j=d.indexOf(">",i+1);if(-1!==j){c=d.substring(i,j+1);var k=this.tagName(c);if(i=j,"breakli"==k){if(!this.isClosingTag(c)){for(var l=e.length-1;l>=0;l--){var m=this.tagName(e[l]);g.push("</"+m+">")}g.push("</li>"),g.push("<li>");for(var n=0;n<e.length;n++)g.push(e[n]);g.push('<span class="f-marker" data-type="true" data-id="0" data-fr-verified="true"></span><span class="f-marker" data-type="false" data-id="0" data-fr-verified="true"></span>')}}else if(g.push(c),!this.isSelfClosingTag(c))if(this.isClosingTag(c)){var o=f[k].pop();e.splice(o,1)}else e.push(c),void 0===f[k]&&(f[k]=[]),f[k].push(e.length-1)}}else h++,g.push(char);var p=a(b.parents("ul, ol")[0]);b.replaceWith("<li>"+g.join("")+"</li>"),p.find(a.Editable.VALID_NODES.join(",")).each(function(b,c){"LI"!=c.tagName&&0===a(c).find("br").length&&""===a(c).text().trim()&&a(c).append("<br/>")}),p.find("li").each(function(b,c){0===a(c).find("br").length&&""===a(c).text().trim()&&a(c).append("<br/>")})},a.Editable.prototype.liEnter=function(){var b,c=this.getSelectionElement();return a(c).parents("table").length>0?!0:(b="LI"==c.tagName?a(c):a(c).parents("li:first"),0===b.text().length&&0===b.find("img").length?this.emptyLiEnter(b):this.textLiEnter(b),this.restoreSelectionByMarkers(),this.sync(),this.saveUndoStep(),!1)},a.Editable.prototype.listInit=function(){this.isImage||this.isLink||this.options.editInPopup||this.$element.on("keydown",a.proxy(function(b){var c=b.which,d=this.getSelectionElement();if("LI"==d.tagName||a(d).parents("li").length>0){if(13==c&&!b.shiftKey)return this.liEnter();if(8==c)return this.liBackspace()}},this))},a.Editable.initializers.push(a.Editable.prototype.listInit),a.Editable.prototype.formatList=function(b){if(this.browser.msie&&a.Editable.getIEversion()<9)return document.execCommand(b,!1,!1),!1;var c=!1;this.isActive(b)||(c=!0),this.saveSelectionByMarkers();for(var d,e=this.getSelectionElements(),f=!0,g=!1,h=0;h<e.length;h++)if(d=a(e[h]),d.parents("li").length>0||"LI"==d.get(0).tagName){var i;i="LI"==d.get(0).tagName?d:d.parents("li");var j=d.parents("ol, ul");if(j.length>0){var k=j[0].tagName.toLowerCase();i.before('<span class="close-'+k+'" data-fr-verified="true"></span>'),i.after('<span class="open-'+k+'" data-fr-verified="true"></span>')}0===a(j[0]).parents("ol, ul").length&&i.replaceWith(i.contents()),g=!0}else f=!1;if(g&&this.cleanupLists(),this.clearSelection(),f===!1||c===!0){this.wrapText(),this.restoreSelectionByMarkers(),e=this.getSelectionElements(),this.saveSelectionByMarkers();var l=a("<ol>");"insertUnorderedList"==b&&(l=a("<ul>"));for(var m=0;m<e.length;m++)d=a(e[m]),d.get(0)!=this.$element.get(0)&&(l.append(a("<li>").append(d.clone())),m!=e.length-1?d.remove():(d.replaceWith(l),l.find("li")));this.unwrapText()}this.restoreSelectionByMarkers(),this.repositionEditor(),this.callback(b)},a.Editable.prototype.cleanupLists=function(){for(var b=this.$element.find("ul, ol").find("ol + ol, ul + ul"),c=0;c<b.length;c++){var d=a(b[c]);d.prev().append(d.html()),d.remove()}this.$element.find("ul, ol").each(function(b,c){var d=a(c);if(d.find(".close-ul, .open-ul, .close-ol, .open-ol").length>0){var e="<"+c.tagName.toLowerCase()+">"+d.html()+"</"+c.tagName.toLowerCase()+">";e=e.replace(new RegExp('<span class="close-ul" data-fr-verified="true"></span>',"g"),"</ul>"),e=e.replace(new RegExp('<span class="open-ul" data-fr-verified="true"></span>',"g"),"<ul>"),e=e.replace(new RegExp('<span class="close-ol" data-fr-verified="true"></span>',"g"),"</ol>"),e=e.replace(new RegExp('<span class="open-ol" data-fr-verified="true"></span>',"g"),"<ol>"),d.replaceWith(e)}}),this.$element.find("ul, ol").each(function(b,c){var d=a(c);0===d.find("li").length&&d.remove()})},a.Editable.prototype.indentLi=function(a){var b=a.closest("ul, ol"),c=b.get(0).tagName.toLowerCase();a.wrap("<"+c+"></"+c+">")},a.Editable.prototype.outdentLi=function(b){var c=a(b.parents("ul, ol")[0]),d=c.parents("ul, ol"),e=c.get(0).tagName.toLowerCase();b.before('<span class="close-'+e+'" data-fr-verified="true"></span>'),b.after('<span class="open-'+e+'" data-fr-verified="true"></span>'),d.length||b.replaceWith(b.html())}}(jQuery);